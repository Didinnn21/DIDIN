<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tuyul & Buu Mantrii üíò</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        html,
        body {
            height: 100%;
            font-family: 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #ff4da6, #1a001f 70%);
            color: white;
            overflow: hidden;
        }

        /* ===== START SCREEN ===== */
        #startScreen {
            position: fixed;
            width: 100%;
            height: 100dvh;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 25px;
            background: radial-gradient(circle, #ff4da6, #1a001f);
            z-index: 10;
        }

        .start-box {
            max-width: 500px
        }

        .start-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 30px;
            background: linear-gradient(90deg, #ff4da6, #ff66cc);
            color: white;
            font-size: 16px;
            margin-top: 20px;
        }

        /* ===== GAME ===== */
        #game {
            position: relative;
            width: 100%;
            height: 100dvh;
            overflow: hidden;
            display: none;
        }

        .player,
        .object {
            position: absolute;
            font-size: 28px;
        }

        .player {
            font-size: 30px;
        }

        #ui {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            display: flex;
            justify-content: space-between;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            font-size: 14px;
        }

        .progress {
            position: absolute;
            bottom: 110px;
            left: 50%;
            transform: translateX(-50%);
            width: 75%;
            height: 12px;
            background: #333;
            border-radius: 10px;
        }

        .bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff4da6, #ff99cc);
            transition: 0.2s;
        }

        #controls {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .ctrl-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 22px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .ctrl-btn:active {
            background: #ff4da6
        }

        @media(min-width:768px) {
            #controls {
                display: none;
            }
        }

        .center {
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            text-align: center;
            background: radial-gradient(circle, #ff4da6, #1a001f);
        }
    </style>
</head>

<body>

    <audio id="bgMusic" src="game.mp3" loop></audio>
    <audio id="winMusic" src="win.mp3"></audio>

    <!-- START SCREEN -->
    <div id="startScreen">
        <div class="start-box">
            <h1>üíò Misi Tuyul untuk Buu Mantrii üíò</h1>
            <p>
                üëª Kumpulkan semua üíñ <br>
                üíî Hindari musuh <br>
                üéÆ WASD / Tombol HP <br>
                ‚ö° Dash untuk lari cepat <br><br>
                üéØ Selesaikan 3 level untuk membuka hadiah Valentine
            </p>
            <button class="start-btn" onclick="startGame()">Mulai üíò</button>
        </div>
    </div>

    <!-- GAME -->
    <div id="game">
        <div id="ui">
            <div>‚ù§Ô∏è <span id="life">3</span></div>
            <div>Level <span id="level">1</span></div>
            <div>Dash <span id="dash">Ready</span></div>
        </div>

        <div id="player" class="player">üëª</div>

        <div class="progress">
            <div id="bar" class="bar"></div>
        </div>

        <div id="controls">
            <button class="ctrl-btn" id="up">‚¨ÜÔ∏è</button>
            <button class="ctrl-btn" id="left">‚¨ÖÔ∏è</button>
            <button class="ctrl-btn" id="down">‚¨áÔ∏è</button>
            <button class="ctrl-btn" id="right">‚û°Ô∏è</button>
            <button class="ctrl-btn" id="dashBtn">‚ö°</button>
        </div>
    </div>

    <script>

        let bgMusic = document.getElementById("bgMusic");
        let winMusic = document.getElementById("winMusic");

        let player = document.getElementById("player");
        let lifeEl = document.getElementById("life");
        let levelEl = document.getElementById("level");
        let dashEl = document.getElementById("dash");
        let bar = document.getElementById("bar");

        let x, y;
        let speed = 3;
        let baseSpeed = 3;
        let dashReady = true;
        let keys = {};
        let objects = [];
        let life, level, collected, required;
        let gameRunning = false;

        function resetValues() {
            life = 3;
            level = 1;
            collected = 0;
            required = 8;
            x = 100;
            y = 150;
            speed = baseSpeed;
            dashReady = true;
            lifeEl.textContent = life;
            levelEl.textContent = level;
            bar.style.width = "0%";
        }

        function startGame() {
            document.getElementById("startScreen").style.display = "none";
            document.getElementById("game").style.display = "block";
            bgMusic.currentTime = 0;
            bgMusic.volume = 0.5;
            bgMusic.play();
            resetValues();
            startLevel();
            if (!gameRunning) {
                update();
                gameRunning = true;
            }
        }

        function restartGame() {
            winMusic.pause();
            winMusic.currentTime = 0;
            document.querySelector(".center").remove();
            document.getElementById("game").style.display = "block";
            bgMusic.play();
            resetValues();
            startLevel();
        }

        document.addEventListener("keydown", e => {
            keys[e.key] = true;
            if (e.key === "Shift") activateDash();
        });
        document.addEventListener("keyup", e => keys[e.key] = false);

        function holdButton(id, key) {
            let btn = document.getElementById(id);
            btn.addEventListener("touchstart", e => {
                e.preventDefault();
                keys[key] = true;
            });
            btn.addEventListener("touchend", e => {
                e.preventDefault();
                keys[key] = false;
            });
        }

        holdButton("up", "w");
        holdButton("down", "s");
        holdButton("left", "a");
        holdButton("right", "d");
        document.getElementById("dashBtn").addEventListener("touchstart", activateDash);

        function activateDash() {
            if (dashReady) {
                speed = 7;
                dashReady = false;
                dashEl.textContent = "Cooldown";
                setTimeout(() => speed = baseSpeed, 200);
                setTimeout(() => {
                    dashReady = true;
                    dashEl.textContent = "Ready";
                }, 1500);
            }
        }

        function createObject(type) {
            let el = document.createElement("div");
            el.classList.add("object");
            el.textContent = type === "heart" ? "üíñ" : "üíî";

            let safeTop = 80;
            let safeBottom = 160;

            el.style.left = Math.random() * (window.innerWidth - 40) + "px";
            el.style.top = (Math.random() * (window.innerHeight - safeBottom - safeTop) + safeTop) + "px";

            document.getElementById("game").appendChild(el);
            objects.push({ el, type });
        }

        function startLevel() {
            objects.forEach(o => o.el.remove());
            objects = [];
            collected = 0;
            required = 8 + level * 2;
            levelEl.textContent = level;

            for (let i = 0; i < required; i++) createObject("heart");
            for (let i = 0; i < level; i++) createObject("enemy");
        }

        function update() {

            if (keys["ArrowRight"] || keys["d"]) x += speed;
            if (keys["ArrowLeft"] || keys["a"]) x -= speed;
            if (keys["ArrowUp"] || keys["w"]) y -= speed;
            if (keys["ArrowDown"] || keys["s"]) y += speed;

            const pw = player.offsetWidth;
            const ph = player.offsetHeight;

            x = Math.max(0, Math.min(window.innerWidth - pw, x));
            y = Math.max(60, Math.min(window.innerHeight - ph - 120, y));

            player.style.left = x + "px";
            player.style.top = y + "px";

            objects.forEach((obj, index) => {
                if (obj.type === "enemy") {
                    let dx = x - obj.el.offsetLeft;
                    let dy = y - obj.el.offsetTop;
                    let dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist > 0) {
                        obj.el.style.left = (obj.el.offsetLeft + (dx / dist) * (1 + level * 0.4)) + "px";
                        obj.el.style.top = (obj.el.offsetTop + (dy / dist) * (1 + level * 0.4)) + "px";
                    }
                }

                if (collide(player, obj.el)) {
                    if (obj.type === "enemy") {
                        life--;
                        lifeEl.textContent = life;
                        obj.el.remove();
                        objects.splice(index, 1);
                        if (life <= 0) resetValues(), startLevel();
                    } else {
                        collected++;
                        obj.el.remove();
                        objects.splice(index, 1);
                        bar.style.width = (collected / required * 100) + "%";
                        if (collected >= required) {
                            level++;
                            if (level > 3) winGame();
                            else startLevel();
                        }
                    }
                }
            });

            requestAnimationFrame(update);
        }

        function collide(a, b) {
            let r1 = a.getBoundingClientRect();
            let r2 = b.getBoundingClientRect();
            return !(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom);
        }

        function winGame() {
            bgMusic.pause();
            winMusic.volume = 0.7;
            winMusic.play();

            document.getElementById("game").style.display = "none";

            let winScreen = document.createElement("div");
            winScreen.className = "center";
            winScreen.innerHTML = `
    <div style="font-size:120px;">üåπ</div>
    <h1>Happy Valentine üíò</h1>
    <p style="max-width:600px;margin-top:20px;line-height:1.8;font-size:18px;">
      Terima kasih sudah hadir di hidupku ü§ç
    </p>
    <button onclick="restartGame()" 
      style="margin-top:40px;padding:12px 25px;border:none;border-radius:25px;
      background:linear-gradient(90deg,#ff4da6,#ff66cc);
      color:white;font-size:16px;">
      Main Lagi üíò
    </button>
  `;
            document.body.appendChild(winScreen);
        }

    </script>
</body>

</html>